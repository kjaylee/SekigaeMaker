<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <style>
      li {
        text-align: center;
        list-style: none;
        height: 80px;
      }
      .green {
        background: mediumaquamarine;
      }
      .gray{
        background: gainsboro;
      }
      .seat{
        height: 80px;
        width: 80px;
        display: inline-block;
        border: 2px solid white;
        box-sizing: border-box;
        text-align: center;
      }
      [v-cloak] {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="app" v-cloak>
      <v-app>
        <v-container fluid>
          <v-row>
            <!-- タイトル -->
            <v-col>
              <h1 class="text-center">席替えメーカー（実装５日目）</h1>
            </v-col>
          </v-row>

          <v-row>
            <!-- 座席テーブル -->
            <v-col cols="6" style="background-color: lightskyblue">
              <p style="text-align: center">生徒の名前を入力してください</p>
              <p style="text-align: center">現在の座席に名前を入力することで、全員移動させることもできます</p>
              <div id="seatArrange">
                <li v-for="( seats, indexRow ) in seatsTable">
                  <textarea v-for="( seat, indexCol ) in seats" class="seat"
                  :class="getColor( seatsTable[indexRow][indexCol] )" @input="writeStudentName( indexRow, indexCol, $event.target.value ); countSeats()"
                  :key="indexRow.toString() + indexCol.toString()" style="text-align: center;  resize: none; word-break: keep-all"
                  :value="seatsTable[indexRow][indexCol]">
                  </textarea>
                </li>
              </div>
            </v-col>

            <v-col cols="6">
              <v-row>
                <!-- よこの座席数入力フォーム -->
                <v-col cols="6" style="background-color: turquoise">
                  <v-select :items="seatsOptionsX" label="よこの座席数" outlined　v-model.number="seatsSizeX"
                  @change="makeTable()" style="width:100px"></v-select>
                </v-col>

                <!-- たての座席数入力フォーム -->
                <v-col cols="6" style="background-color: lightseagreen">
                  <v-select :items="seatsOptionsY" label="たての座席数" outlined　v-model.number="seatsSizeY"
                  @change="makeTable()" style="width:100px"></v-select>
                </v-col>

                <!-- 同じ席にしないかどうかのチェックボックス -->
                <v-col cols="12" style="background-color: orange">
                  <v-checkbox label="現在の座席と異なる座席にする" color="indigo darken-3" value="indigo darken-3"
                  hide-details></v-checkbox>
                </v-col>

                <!-- 近づける生徒のエクスパンションパネル -->
                <v-col cols="12" style="background-color: burlywood">
                  <v-expansion-panels accordion>
                    <v-expansion-panel>
                      <v-expansion-panel-header>近づける生徒を入力する</v-expansion-panel-header>
                      <v-expansion-panel-content>
                        <!-- 近づける生徒の入力フォーム（初期表示のための１つ目） -->
                        <div>
                          <v-select :items="studentsName" placeholder="Aさん" outlined style="width:200px; display: inline-block"
                          @change=""></v-select>
                          と
                          <v-select :items="studentsName" placeholder="Bさん" outlined style="width:200px; display: inline-block"></v-select>
                          の間を
                          <v-select :items="distanceOptions" outlined style="width:70px; display: inline-block" @change="addTests"></v-select>
                          以下にする
                        </div>
                        <!-- 近づける生徒の入力フォーム（追加表示のための２つ目以降） -->
                        <div v-for="test in tests">
                          <v-select :items="studentsName" placeholder="Aさん" outlined style="width:200px; display: inline-block"></v-select>
                          と
                          <v-select :items="studentsName" placeholder="Bさん" outlined style="width:200px; display: inline-block"></v-select>
                          の間を
                          <v-select :items="distanceOptions" outlined style="width:70px; display: inline-block" @change="addTests"></v-select>
                          以下にする
                        </div>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </v-col>

                <!-- 離す生徒のエクスパンションパネル -->
                <v-col cols="12" style="background-color: lightgreen">
                  <v-expansion-panels accordion>
                    <v-expansion-panel>
                      <v-expansion-panel-header>離す生徒を入力する</v-expansion-panel-header>
                      <v-expansion-panel-content>
                        <!-- 離す生徒の入力フォーム -->
                        <div>
                          <v-select :items="studentsName" laceholder="Cさん" outlined style="width:200px; display: inline-block"></v-select>
                          と
                          <v-select :items="studentsName" laceholder="Dさん" outlined style="width:200px; display: inline-block"></v-select>
                          の間を
                          <v-select :items="distanceOptions" outlined style="width:70px; display: inline-block"></v-select>
                          以上にする
                        </div>
                      </v-expansion-panel-content>
                    </v-expansion-panel>
                  </v-expansion-panels>
                </v-col>


                <!-- 現在の有効な座席数を表示 -->
                <v-col cols="12" style="background-color: violet">
                  選択された座席数：{{ seats_num }}
                </v-col>

                <!-- 席替えボタン -->
                <v-col cols="12" style="background-color: khaki">
                  <v-btn elevation="2" outlined>席替え！</v-btn>
                </v-col>
              </v-row>
            </v-col>
          </v-row>

          <v-row>
            <v-col cols="6">
              <div>
                <p>現在の座席記憶用テーブル</p>
                <p v-for="seats in seatsTable">{{ seats }}</p>
              </div>
            </v-col>
            <v-col cols="6">
              <p>生徒の名前用配列</p>
              {{ studentsName }}
            </v-col>
          </v-row>

        </v-container>
      </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

    <script>
      const app = new Vue({
        el: "#app",
        vuetify: new Vuetify(),
        data: {
          seatsSizeY: 6, // デフォルト値は6
          seatsSizeX: 6, // デフォルト値は6
          seatsTable: [], // 座席テーブル 座れない座席 -1, 座れる座席 1
          seats_num: 0, // 有効な座席数
          seatsOptionsX: [1,2,3,4,5,6,7,8], //よこの座席数入力フォームの選択肢
          seatsOptionsY: [1,2,3,4,5,6,7,8], //たての座席数入力フォームの選択肢
          distanceOptions: [1,2,3,4,5,6,7,8], //近づける・離す距離の選択肢
          studentsName: [],
          tests: []
        },
        methods: {
          getColor(seat) { // 座席の種類に応じた色を返す
            if (seat === '') return 'gray'
            else return 'green'
          },
          writeStudentName(indexRow, indexCol, name) { // 引数で受け取った座席の有効、無効を切り替える
            this.seatsTable[indexRow].splice(indexCol, 1, name)
            console.log(`${indexRow}${indexCol}が入力されたよー`);
            console.log(name);
            console.log(`${this.seatsTable[indexRow][indexCol]}`);
          },
          makeTable() { // seatsTableを作成
            this.seatsTable = []
            for(let i = 0; i < this.seatsSizeY; i++) {
              this.seatsTable.push( Array(this.seatsSizeX).fill('') ) // すべての席に名前が未入力な状態でテーブルを作成
            }
            /* テストのため始めから入力 */
            this.seatsTable.splice(0, 1, ['菊本さん', '', '', '', '大地さん', '']);
            this.seatsTable.splice(1, 1, ['', '', 'たかこ\nさん', '', '', '']);
            this.seatsTable.splice(2, 1, ['', '廣瀬さん', '', '', 'ののか\nさん', '']);
            this.seatsTable.splice(3, 1, ['', '', '', '平尾さん', '', 'かんぬ\nさん']);
            /* ここまで */
            this.countSeats();
            console.log(`${this.seatsSizeX}x${this.seatsSizeY}でmakeTableを実行したよー`);
          },
          countSeats() { // 有効な座席数をカウント
            this.seats_num = 0;
            this.seatsTable.forEach(seats => {
              seats.forEach(seat => {
                if (seat !== '') this.seats_num += 1
              })
            })
            console.log(this.seats_num);
          },
          addTests() {
            this.tests.push(1);
            console.log('addTestsが実行されたよー')
          }
        },
        mounted() {
          this.makeTable() // 最初にseatsTableを作成
        },
        watch: {
          seatsTable: {
            handler: function(){
              this.studentsName = Array.prototype.concat.apply([], this.seatsTable);
            },
            deep: true
          }
        }
      });
    </script>
  </body>
</html>


